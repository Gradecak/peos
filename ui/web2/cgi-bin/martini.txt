0 mix_and_pour type branch children ( mix prepare_loop )
1 add_ice type action mode manual requires { ice shaker } provides { shaker } agent { bartender } script { add enough ice to shaker so that the gin will just barely cover it. } 
2 add_vermouth type action mode manual requires { vermouth shaker } provides { shaker } agent { bartender } script { add generous amount of vermouth, swirl in shaker so ice and sides are coated, then discard. } 
3 add_gin type action mode manual requires { gin shaker } provides { shaker } agent { bartender } script { add appropriate amount of gin (preferably Beefeaters), about two ounces per martini. } 
4 shake type action mode manual requires { shaker } provides { shaker } agent { bartender } script { shake gently until ingredients are well chilled.  The shaking should not be so violent that it breaks chips off the ice; a vigourous swirling motion can be substituted. } 
5 wash_olive type action mode manual requires { olive } provides { olive } agent { bartender } script { if you are not using olives packed in vermouth, wash one or two olives per martini under tap to remove the brine } 
6 skewer_olive type action mode manual requires { olive martini-glass toothpick } provides { martini-glass } agent { bartender } script { place one or two olives on a toothpick and insert into well chilled martini glass } 
7 pour type action mode manual requires { martini-glass pitcher } provides { martini } agent { bartender } script { pour an appropriate amount into a prepared martini glass.  Appropriate is enough so that all glasses end up with the same amount. } 
8 start
9 push 0 
10 pop 
11 call set ready mix_and_pour pour 
12 jzero 117
13 pop
14 call wait active mix_and_pour pour 
15 jump 117 16 100
16 call set none pour
17 push 0
18 call fork 32
19 jzero 117
20 pop
21 incr
22 call fork 73
23 jzero 117
24 pop
25 incr
26 call join
27 jzero 117
28 pop
29 decr
30 jzero 99
31 goto 26
32 push 0 
33 pop 
34 call set ready add_ice
35 jzero 117
36 pop
37 call wait done add_ice
38 jzero 117
39 pop
40 call assert 
41 jzero 117
42 push 0 
43 pop 
44 call set ready add_vermouth
45 jzero 117
46 pop
47 call wait done add_vermouth
48 jzero 117
49 pop
50 call assert 
51 jzero 117
52 push 0 
53 pop 
54 call set ready add_gin
55 jzero 117
56 pop
57 call wait done add_gin
58 jzero 117
59 pop
60 call assert 
61 jzero 117
62 push 0 
63 pop 
64 call set ready shake
65 jzero 117
66 pop
67 call wait done shake
68 jzero 117
69 pop
70 call assert 
71 jzero 117
72 call exit
73 push 0 
74 pop 
75 call set ready wash_olive 
76 jzero 117
77 pop
78 call wait active wash_olive pour 
79 jump 117 80 97
80 call set none pour
81 call wait done wash_olive
82 jzero 117
83 pop
84 call assert 
85 jzero 117
86 push 0 
87 pop 
88 call set ready skewer_olive
89 jzero 117
90 pop
91 call wait done skewer_olive
92 jzero 117
93 pop
94 call assert 
95 jzero 117
96 goto 75
97 call set none wash_olive 
98 call exit
99 goto 11
100 call set none mix_and_pour 
101 push 0 
102 pop 
103 call set ready end
104 jzero 117
105 pop
106 call wait active pour end
107 jump 117 108 115
108 call set none end
109 call wait done pour
110 jzero 117
111 pop
112 call assert 
113 jzero 117
114 goto 103
115 call set none pour 
116 end
117 call error
