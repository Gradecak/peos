#!/usr/bin/perl
# $Id: create.test,v 1.2 2007/04/29 18:54:27 jnoll Exp $ -*-perl-*-
# Test update cgi script.
use CGI::Test;                 # exports ok()
require CGI::Test::Input::URL;
use CGI::Test::Form;


# Clear process table.
$r = `rm -f ../proc_table.dat`;
$r = `rm -f ../proc_table.dat.xml`;

# Create a test object to run the test.
my $basedir = "http://localhost/peos_test/cgi-bin";
my $t = CGI::Test->new(
			-base_url   => $basedir,
			-cgi_dir    => "..",
			);

# Create a URL to invoke the script.
my $input = CGI::Test::Input::URL->new() ;
$input->add_field("model", "readme");
print $input->data, " ", $input->length, "\n";

my $result = $t->POST("${basedir}/create.cgi", $input);
ok "result: defined", defined $result;
ok "result: is ok",  $result->is_ok;
ok "result: content_type", $result->content_type =~ m|text/html\b|;
ok "result: readme.pml present", $result->raw_content =~ m|PID=0.*/readme.pml|;

print $result->raw_content;


my $input = CGI::Test::Input::URL->new() ;
$input->add_field("model", "test");
print $input->data, " ", $input->length, "\n";

my $result = $t->POST("${basedir}/create.cgi", $input);
ok "result: defined", defined $result;
ok "result: is ok",  $result->is_ok;
ok "result: content_type", $result->content_type =~ m|text/html\b|;
ok "result: test.pml present", $result->raw_content =~ m|PID=1.*/test.pml|;

print $result->raw_content;


my $input = CGI::Test::Input::URL->new() ;
$input->add_field("model", "test_action");
print $input->data, " ", $input->length, "\n";

my $result = $t->POST("${basedir}/create.cgi", $input);
ok "result: defined", defined $result;
ok "result: is ok",  $result->is_ok;
ok "result: content_type", $result->content_type =~ m|text/html\b|;
ok "result: test_action.pml present", $result->raw_content =~ m|PID=2.*/test_action.pml|;

print $result->raw_content;
